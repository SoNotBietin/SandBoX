<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platformer Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            background-color: #00FF00; /* Green ground */
            display: block;
        }
        #healthDisplay {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 20px;
        }
        #gameOverScreen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            text-align: center;
            font-size: 40px;
            color: white;
        }
    </style>
</head>
<body>
    <div id="healthDisplay">Health: <span id="healthValue">100</span></div>
    <canvas id="gameCanvas"></canvas>
    <div id="gameOverScreen">
        <p>Game Over</p>
        <p>Score: <span id="finalScore">0</span></p>
        <button id="restartButton">Restart</button>
    </div>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const healthDisplay = document.getElementById("healthValue");
        const gameOverScreen = document.getElementById("gameOverScreen");
        const finalScoreDisplay = document.getElementById("finalScore");
        const restartButton = document.getElementById("restartButton");
        
        // Set canvas dimensions to match the screen
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Player properties
        const player = {
            x: canvas.width / 2, // Initial X position
            y: canvas.height / 2, // Initial Y position
            size: 50, // Size of the player (adjust as needed)
            color: "red", // Player color
            speed: 15, // Player movement speed
            health: 100, // Player's health
        };
        
        // Touch joystick properties
        const joystick = {
            x: 100, // Joystick X position
            y: canvas.height - 100, // Joystick Y position
            outerRadius: 40, // Outer circle radius
            innerRadius: 20, // Inner circle radius
        };
        
        // Obstacles array
        const obstacles = [];
        
        // Initialize joystick position
        let joystickX = joystick.x;
        let joystickY = joystick.y;
        let isJoystickReleased = true; // Flag to check if joystick is released
        
        // Initialize game state
        let isGameOver = false;
        
        // Function to create obstacles
        function createObstacle() {
            if (!isGameOver) {
                const obstacle = {
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: 30,
                    color: "red",
                };
                obstacles.push(obstacle);
            }
        }
        
        // Function to handle collisions with obstacles
        function handleObstacleCollisions() {
            if (!isGameOver) {
                for (let i = 0; i < obstacles.length; i++) {
                    const obstacle = obstacles[i];
                    const distance = Math.sqrt((player.x - obstacle.x) ** 2 + (player.y - obstacle.y) ** 2);
                    if (distance < player.size / 2 + obstacle.size / 2) {
                        // Player collided with an obstacle
                        player.health -= 10; // Decrease health
                        obstacles.splice(i, 1); // Remove the obstacle
                        i--; // Decrement the index to account for the removed obstacle
                        updateHealthDisplay();
                        if (player.health <= 0) {
                            // Player's health is zero, it's game over
                            gameOver();
                        }
                    }
                }
            }
        }
        
        // Function to update health display
        function updateHealthDisplay() {
            healthDisplay.textContent = player.health;
        }
        
        // Function to end the game
        function gameOver() {
            isGameOver = true;
            finalScoreDisplay.textContent = player.health;
            gameOverScreen.style.display = "block";
        }
        
        // Event listener for restart button click
        restartButton.addEventListener("click", () => {
            // Reset game state
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
            player.health = 100;
            isGameOver = false;
            obstacles.length = 0;
            updateHealthDisplay();
            gameOverScreen.style.display = "none";
        });
        
        // Event listener for touch input
        canvas.addEventListener("touchmove", (e) => {
            // Calculate the distance between touch point and joystick center
            const deltaX = e.touches[0].clientX - joystick.x;
            const deltaY = e.touches[0].clientY - joystick.y;
            const distance = Math.sqrt(deltaX ** 2 + deltaY ** 2);
            
            // If the touch point is within the outer circle radius
            if (distance <= joystick.outerRadius) {
                // Update joystick position based on touch input
                joystickX = e.touches[0].clientX;
                joystickY = e.touches[0].clientY;
                isJoystickReleased = false;
            } else {
                // Keep the inner circle (joystick) within the outer circle (joycircle)
                const angle = Math.atan2(deltaY, deltaX);
                joystickX = joystick.x + Math.cos(angle) * joystick.outerRadius;
                joystickY = joystick.y + Math.sin(angle) * joystick.outerRadius;
            }
        });
        
        // Event listener for joystick release
        canvas.addEventListener("touchend", () => {
            isJoystickReleased = true;
            // Spring the inner joycircle back to the middle of the outer joycircle
            joystickX = joystick.x;
            joystickY = joystick.y;
        });
        
        // Game loop
        function gameLoop() {
            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw obstacles
            for (const obstacle of obstacles) {
                ctx.fillStyle = obstacle.color;
                ctx.fillRect(obstacle.x - obstacle.size / 2, obstacle.y - obstacle.size / 2, obstacle.size, obstacle.size);
            }
            
            // Draw the player
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x - player.size / 2, player.y - player.size / 2, player.size, player.size);
            
            // Draw the touch joystick
            ctx.beginPath();
            ctx.arc(joystick.x, joystick.y, joystick.outerRadius, 0, Math.PI * 2);
            ctx.strokeStyle = "white";
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.closePath();
            
            // Draw the inner circle of the joystick
            ctx.beginPath();
            ctx.arc(joystickX, joystickY, joystick.innerRadius, 0, Math.PI * 2);
            ctx.fillStyle = "white";
            ctx.fill();
            ctx.closePath();
            
            // Update player position based on joystick input
            if (!isJoystickReleased) {
                const deltaX = joystickX - joystick.x;
                const deltaY = joystickY - joystick.y;
                const distance = Math.sqrt(deltaX ** 2 + deltaY ** 2);
                
                if (distance > joystick.innerRadius) {
                    const angle = Math.atan2(deltaY, deltaX);
                    const newX = player.x + Math.cos(angle) * player.speed;
                    const newY = player.y + Math.sin(angle) * player.speed;
                    
                    // Check if the new position is within the canvas boundaries
                    if (newX - player.size / 2 >= 0 && newX + player.size / 2 <= canvas.width &&
                        newY - player.size / 2 >= 0 && newY + player.size / 2 <= canvas.height) {
                        player.x = newX;
                        player.y = newY;
                    }
                }
            }
            
            // Handle collisions with obstacles
            handleObstacleCollisions();
            
            // Request animation frame
            requestAnimationFrame(gameLoop);
        }
        
        // Start the game loop
        gameLoop();
        
        // Create initial obstacles
        setInterval(createObstacle, 2000);
    </script>
</body>
</html>
