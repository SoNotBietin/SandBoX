<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platformer Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            background-color: #00FF00; /* Green ground */
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        
        // Set canvas dimensions to match the screen
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Player properties
        const player = {
            x: canvas.width / 2, // Initial X position
            y: canvas.height / 2, // Initial Y position
            size: 50, // Size of the player (adjust as needed)
            color: "red", // Player color
            speed: 15, // Player movement speed (adjusted as requested)
        };
        
        // Touch joystick properties
        const joystick = {
            x: 100, // Joystick X position
            y: canvas.height - 100, // Joystick Y position
            outerRadius: 40, // Outer circle radius
            innerRadius: 20, // Inner circle radius
        };
        
        // Initialize joystick position
        let joystickX = joystick.x;
        let joystickY = joystick.y;
        let isJoystickReleased = true; // Flag to check if joystick is released
        
        // Event listener for touch input
        canvas.addEventListener("touchmove", (e) => {
            // Calculate the distance between touch point and joystick center
            const deltaX = e.touches[0].clientX - joystick.x;
            const deltaY = e.touches[0].clientY - joystick.y;
            const distance = Math.sqrt(deltaX ** 2 + deltaY ** 2);
            
            // If the touch point is within the outer circle radius
            if (distance <= joystick.outerRadius) {
                // Update joystick position based on touch input
                joystickX = e.touches[0].clientX;
                joystickY = e.touches[0].clientY;
                isJoystickReleased = false;
            } else {
                // Keep the inner circle (joystick) within the outer circle (joycircle)
                const angle = Math.atan2(deltaY, deltaX);
                joystickX = joystick.x + Math.cos(angle) * joystick.outerRadius;
                joystickY = joystick.y + Math.sin(angle) * joystick.outerRadius;
            }
        });
        
        // Event listener for joystick release
        canvas.addEventListener("touchend", () => {
            isJoystickReleased = true;
            // Spring the inner joycircle back to the middle of the outer joycircle
            joystickX = joystick.x;
            joystickY = joystick.y;
        });
        
        // Game loop
        function gameLoop() {
            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw the player
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x - player.size / 2, player.y - player.size / 2, player.size, player.size);
            
            // Draw the touch joystick
            ctx.beginPath();
            ctx.arc(joystick.x, joystick.y, joystick.outerRadius, 0, Math.PI * 2);
            ctx.strokeStyle = "white";
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.closePath();
            
            // Draw the inner circle of the joystick
            ctx.beginPath();
            ctx.arc(joystickX, joystickY, joystick.innerRadius, 0, Math.PI * 2);
            ctx.fillStyle = "white";
            ctx.fill();
            ctx.closePath();
            
            // Update player position based on joystick input
            if (!isJoystickReleased) {
                const deltaX = joystickX - joystick.x;
                const deltaY = joystickY - joystick.y;
                const distance = Math.sqrt(deltaX ** 2 + deltaY ** 2);
                
                if (distance > joystick.innerRadius) {
                    const angle = Math.atan2(deltaY, deltaX);
                    const newX = player.x + Math.cos(angle) * player.speed;
                    const newY = player.y + Math.sin(angle) * player.speed;
                    
                    // Check if the new position is within the canvas boundaries
                    if (newX - player.size / 2 >= 0 && newX + player.size / 2 <= canvas.width &&
                        newY - player.size / 2 >= 0 && newY + player.size / 2 <= canvas.height) {
                        player.x = newX;
                        player.y = newY;
                    }
                }
            }
            
            // Request animation frame
            requestAnimationFrame(gameLoop);
        }
        
        // Start the game loop
        gameLoop();
    </script>
</body>
</html>
